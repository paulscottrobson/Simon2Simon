namespace SimonEm
{
	public class SimonHardware : TMS1000
	{
		public bool Start;
		public bool Last;
		public bool Longest;
		public int Game = 1;
		public int Skill = 1;

		public bool[] LightStatus = new bool[4];

		public byte[] SoundBuffer = new byte[100000];

		public int SoundHead;
		public int SoundTail;

		/// <summary>
		/// Constructor uploads simon ROM image
		/// </summary>
		public SimonHardware() : base()
		{
			for (int i = 0; i < 1024; i++)
			{
				rom[i] = romImage[i];
			}
		}

		protected override int InputLines(int[] r)
		{
			int input = 0;

			if (r[0] == 1)
			{
				if (Game == 1) input |= 2;
				else if(Game == 2) input |= 1;
				else if(Game == 3) input |= 4;
			}

			if (r[1] == 1)
			{
				if (LightStatus[0]) input |= 1;
				else if(LightStatus[1]) input |= 2;
				else if(LightStatus[2]) input |= 4;
				else if(LightStatus[3]) input |= 8;
			}

			if (r[2] == 1)
			{
				if (Start) input |= 1;
				else if(Last) input |= 2;
				else if(Longest) input |= 4;
			}

			if (r[9] == 1)
			{
				if (Skill == 1) input |= 2;
				else if(Skill == 2) input |= 4;
				else if(Skill == 3) input |= 8;
				else if(Skill == 4) input |= 1;
			}

			return input;
		}

		protected override void WriteR(int line, int status)
		{
		}

		protected override void WriteO(int value)
		{
		}

		public override void Execute()
		{
			base.Execute();
			//speaker
			SoundBuffer[SoundTail % SoundBuffer.Length] = (byte)getRegisterStatus(8);
			SoundTail++;
		}

		/// <summary>
		/// Numerical dump of Simon ROM image
		/// </summary>
		private static byte[] romImage = { 30, 234, 8, 76, 96, 12, 169, 13, 31, 96, 22, 69, 96, 104, 172, 27, 146, 150, 31, 66, 192, 128, 128, 120, 12, 73, 106, 162, 124, 122, 65, 128, 0, 13, 64, 154, 186, 54, 96, 114, 16, 141, 17, 136, 76, 162, 141, 194, 64, 126, 48, 128, 162, 118, 100, 23, 182, 124, 146, 128, 33, 112, 33, 65, 31, 198, 56, 30, 131, 174, 173, 234, 22, 21, 63, 20, 33, 114, 65, 31, 0, 201, 131, 192, 18, 20, 124, 156, 16, 61, 22, 164, 33, 33, 33, 228, 0, 73, 112, 124, 71, 39, 65, 194, 128, 112, 128, 131, 161, 79, 69, 65, 172, 137, 64, 23, 201, 150, 137, 128, 116, 131, 114, 27, 112, 148, 57, 73, 112, 143, 128, 18, 64, 73, 192, 128, 73, 98, 192, 52, 192, 30, 39, 30, 17, 50, 24, 111, 69, 31, 69, 24, 120, 19, 96, 177, 61, 112, 24, 177, 149, 28, 61, 17, 128, 30, 29, 74, 96, 104, 139, 128, 33, 96, 128, 185, 133, 3, 192, 33, 73, 24, 66, 112, 64, 72, 150, 39, 128, 66, 33, 64, 31, 198, 124, 31, 64, 156, 69, 228, 33, 57, 30, 126, 175, 35, 16, 17, 0, 112, 148, 165, 0, 145, 13, 177, 12, 16, 169, 72, 66, 147, 116, 204, 0, 142, 153, 141, 69, 53, 24, 186, 0, 20, 44, 73, 8, 112, 134, 33, 120, 78, 191, 58, 142, 162, 39, 69, 141, 73, 16, 131, 171, 183, 57, 73, 69, 42, 17, 3, 3, 204, 182, 73, 84, 63, 63, 12, 67, 71, 63, 57, 10, 138, 28, 69, 16, 69, 13, 71, 136, 96, 79, 180, 69, 71, 21, 187, 0, 33, 75, 82, 128, 128, 96, 33, 128, 63, 96, 204, 20, 136, 33, 172, 71, 61, 22, 64, 3, 17, 92, 158, 34, 61, 3, 56, 192, 157, 33, 65, 63, 69, 114, 33, 168, 155, 106, 120, 66, 3, 19, 118, 106, 169, 41, 177, 128, 42, 66, 61, 182, 192, 72, 173, 156, 104, 169, 98, 110, 181, 3, 116, 2, 177, 137, 72, 97, 192, 64, 77, 16, 15, 17, 61, 112, 108, 180, 77, 116, 61, 29, 33, 100, 33, 169, 33, 169, 72, 3, 72, 181, 185, 114, 187, 65, 96, 71, 67, 146, 201, 65, 33, 25, 61, 3, 112, 65, 40, 130, 71, 0, 166, 112, 33, 189, 53, 165, 165, 201, 39, 189, 3, 42, 174, 116, 3, 0, 165, 26, 3, 162, 40, 63, 114, 0, 33, 55, 112, 79, 55, 71, 186, 112, 180, 15, 172, 69, 201, 53, 112, 163, 124, 75, 33, 174, 69, 55, 53, 72, 33, 62, 76, 112, 3, 104, 39, 128, 166, 20, 43, 56, 29, 33, 112, 15, 75, 49, 177, 40, 191, 76, 156, 64, 138, 31, 192, 63, 68, 33, 175, 0, 33, 33, 61, 27, 182, 73, 64, 3, 64, 67, 33, 3, 192, 176, 64, 60, 72, 20, 156, 247, 72, 19, 156, 15, 41, 3, 167, 68, 41, 72, 33, 63, 64, 33, 56, 31, 64, 40, 161, 192, 247, 15, 96, 6, 3, 96, 65, 149, 19, 104, 26, 61, 30, 152, 34, 63, 7, 61, 15, 37, 152, 120, 33, 0, 65, 192, 72, 29, 36, 136, 172, 21, 32, 192, 97, 99, 33, 60, 142, 155, 63, 7, 171, 64, 152, 65, 112, 3, 116, 98, 60, 186, 34, 104, 64, 66, 33, 21, 65, 128, 227, 19, 34, 112, 16, 148, 156, 13, 192, 26, 39, 4, 137, 69, 128, 16, 65, 192, 21, 33, 8, 66, 31, 26, 192, 112, 112, 14, 151, 24, 192, 33, 126, 64, 106, 170, 96, 96, 19, 65, 128, 192, 39, 112, 29, 12, 64, 96, 192, 247, 74, 192, 61, 29, 33, 154, 43, 185, 189, 66, 56, 61, 167, 96, 112, 56, 104, 36, 165, 15, 132, 100, 180, 40, 34, 19, 62, 3, 104, 63, 64, 33, 120, 55, 165, 191, 104, 116, 3, 147, 60, 168, 64, 150, 66, 42, 63, 165, 96, 65, 40, 33, 60, 53, 62, 147, 126, 46, 178, 108, 178, 96, 36, 34, 132, 140, 140, 42, 124, 125, 61, 64, 33, 61, 64, 96, 33, 103, 107, 101, 68, 148, 104, 96, 96, 148, 96, 13, 112, 1, 101, 13, 101, 63, 99, 148, 148, 104, 100, 97, 148, 104, 100, 114, 179, 5, 13, 96, 13, 96, 96, 106, 104, 15, 97, 108, 104, 110, 100, 103, 182, 107, 96, 96, 104, 96, 100, 106, 124, 101, 153, 104, 174, 145, 116, 172, 120, 61, 72, 77, 42, 42, 3, 3, 159, 75, 178, 12, 69, 178, 65, 42, 170, 26, 3, 78, 32, 15, 162, 33, 42, 3, 188, 33, 13, 32, 181, 3, 32, 146, 33, 67, 173, 33, 65, 42, 32, 3, 3, 63, 66, 69, 70, 134, 73, 74, 134, 3, 181, 67, 3, 139, 33, 42, 42, 128, 76, 65, 3, 65, 33, 65, 96, 75, 71, 116, 38, 75, 104, 71, 143, 54, 177, 165, 40, 71, 71, 0, 40, 104, 64, 0, 28, 79, 70, 75, 75, 169, 136, 78, 39, 50, 34, 0, 136, 3, 128, 147, 64, 58, 33, 0, 65, 164, 33, 3, 40, 33, 64, 96, 23, 96, 79, 136, 130, 3, 136, 3, 3, 112, 112, 70, 12, 8, 13, 78, 56, 79, 189, 96, 33, 132, 58, 116, 144, 98, 78, 100, 116, 57, 158, 15, 170, 120, 104, 144, 144, 176, 120, 136, 144, 178, 147, 180, 176, 70, 57, 45, 134, 168, 120, 138, 144, 144, 70, 102, 65, 106, 59, 27, 140, 184, 172, 27, 65, 108, 172, 33, 70, 114, 176, 33, 176, 172, 56, 58, 70, 181, 167, 11, 47, 25, 63, 32, 128, 73, 79, 65, 42, 49, 73, 42, 53, 63, 12, 9, 42, 15, 170, 63, 148, 65, 56, 66, 170, 96, 61, 16, 15, 35, 3, 0, 96, 170, 176, 61, 73, 32, 12, 15, 63, 3, 152, 100, 96, 177, 66, 96, 18, 63, 36, 101, 96, 65, 61, 128, 37, 65, 128, 64, 16, 143, 44 };
	}
}
